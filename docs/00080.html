<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN">
<html>
<head>
<title>DRV_BM64_BufferAddRead Function</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Doc-O-Matic" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <link rel="STYLESHEET" href="default.css" type="text/css" />

<script type="text/javascript" src="scripts.js"></script>
</head>
<body class="Element700" onload="onBodyLoadEx('frames.html', 'topic', '00080.html');" onmousedown="onBodyMouseDown();">

<!-- Begin Popups -->

<!-- End Popups -->

<!-- Begin Page Header -->
<div class="Element710" id="areafixed">
<div class="Element94">
<a href="00023.html" target="topic">Drivers Libraries Help</a> &gt; <a href="00016.html" target="topic">BM64 Bluetooth Driver Library</a> &gt; <a href="00045.html" target="topic">Library Interface</a> &gt; c) Data Transfer Functions &gt; <a href="00080.html" target="topic">DRV_BM64_BufferAddRead Function</a></div>
<div class="Element92">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element1">
MPLAB Harmony Bluetooth Help</div>
</td><td width="25%">
<div class="Element2">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00020.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element90">
<a href="00151.html" target="topic">Previous</a> | <a href="00045.html" target="topic">Up</a> | <a href="00219.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element96">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRV_BM64_BufferAddRead@DRV_HANDLE@DRV_BM64_BUFFER_HANDLE *@void *@size_t Topic Title: DRV_BM64_BufferAddRead Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table><div class="Element5">
DRV_BM64_BufferAddRead Function</div>
</div>
</div>

<!-- End Page Header -->

<!-- Begin Client Area -->
<div class="Element720" id="areascroll">
<div class="Element721">

<!-- Begin Page Content -->
<a name="PageContent"></a><div class="Element58">
<a name="46756E6374696F6E"></a><div class="Element11">
<div class="Element10">
<p class="Element10">
    void DRV_BM64_BufferAddRead(const DRV_HANDLE handle,&nbsp;</p>
<p class="Element10">
        DRV_BM6_BUFFER_HANDLE *bufferHandle, void *buffer, size_t size)&nbsp;</p>
<p class="Element10">
&nbsp;</p></div>
</div>
<a name="53756D6D617279"></a><div class="Element14">
<a onclick="toggleVisibilityStored('53756D6D617279');" class="a_Element14"><img src="btn_collapse_large.gif" border="0" alt="" title="" id="img53756D6D617279">Summary</a></div>
<div id="div53756D6D617279">
<div class="Element11">
<div class="Element10">
<p class="Element10">
Schedule a non-blocking driver read operation.</p></div>
</div>
</div>
<a name="4465736372697074696F6E"></a><div class="Element14">
Description</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
This function schedules a non-blocking read operation. The function returns with a valid buffer handle in the bufferHandle argument if the read request was scheduled successfully. The function adds the request to the hardware instance receive queue and returns immediately. While the request is in the queue, the application buffer is owned by the driver and should not be modified. The function returns <a href="00079.html" target="topic">DRV_BM64_BUFFER_HANDLE_INVALID</a></p>
<ul class="Element630">
<li class="Element600">if a buffer could not be allocated to the request</li>
<li class="Element600">if the input buffer pointer is NULL</li>
<li class="Element600">if the buffer size is 0.</li>
<li class="Element600">if the queue is full or the queue depth is insufficient</li>
</ul><p class="Element10">
If the requesting client registered an event callback with the driver, the driver will issue a <a href="00076.html" target="topic">DRV_BM64_BUFFER_EVENT_COMPLETE</a> event if the buffer was processed successfully of DRV_BM64_BUFFER_EVENT_ERROR event if the buffer was not processed successfully.</p></div>
</div>
<a name="507265636F6E646974696F6E73"></a><div class="Element14">
Preconditions</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
<a href="00173.html" target="topic">DRV_BM64_Open</a> must have been called to obtain a valid opened device handle.</p></div>
</div>
<a name="506172616D6574657273"></a><div class="Element14">
Parameters</div>
<div class="Element11">
<div class="Element10">
<div class="Element312">
<div class="TableDiv">
<table cellspacing="0" class="Table4">
<tr>
<td class="Element300" valign="top" width="35%">
<div class="Element301">
Parameters&nbsp;</div></td><td class="Element304" valign="top" width="65%">
<div class="Element305">
Description&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
handle&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
valid handle to an opened BM64 device driver unique to client&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
bufferHandle&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
pointer to an argument that contains the return buffer handle&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
buffer&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
pointer to buffer that will contain received data&nbsp;</div></td></tr><tr>
<td class="Element302" valign="top" width="35%">
<div class="Element303">
size&nbsp;</div></td><td class="Element306" valign="top" width="65%">
<div class="Element307">
buffer size in bytes.&nbsp;</div></td></tr></table></div></div>
</div>
</div>
<a name="52657475726E73"></a><div class="Element14">
Returns</div>
<div class="Element11">
<div class="Element10">
<p class="Element10">
The bufferHandle parameter will contain the return buffer handle. This will be <a href="00079.html" target="topic">DRV_BM64_BUFFER_HANDLE_INVALID</a> if the function was not successful.</p></div>
</div>
<a name="4578616D706C65"></a><div class="Element14">
Example</div>
<div class="Element11">
<div class="Element10">
<div class="Element13"><div class="Element12"><pre class="Element12"><strong><span style="color: #000080">case</span></strong> APP_STATE_BT_BUFFER_COMPLETE:
{
   <i><span style="color: #008000">//BT RX</span></i>
   <strong><span style="color: #000080">if</span></strong> (!_bufferUsed[appData.readIndex])
   {
       <i><span style="color: #008000">//Next BT Read Queued</span></i>
       <i><span style="color: #008000">// note generic version of call (DRV_BT instead of DRV_BM64) is used</span></i>
       DRV_BT_BufferAddRead(appData.bt.handle, 
                             &amp;appData.bt.readBufHandle, 
                             audioBuffer[appData.readIndex], 
                             appData.bt.bufferSize); 

       <strong><span style="color: #000080">if</span></strong>(appData.bt.readBufHandle != DRV_BT_BUFFER_HANDLE_INVALID)
       {
           appData.bt.readBufHandle = DRV_BT_BUFFER_HANDLE_INVALID; 
           _bufferUsed[appData.readIndex] = <strong><span style="color: #000080">true</span></strong>;

           <i><span style="color: #008000">//QUEUE HEAD Index (for next BT read)  </span></i>
           appData.readIndex++;      
           <strong><span style="color: #000080">if</span></strong>(appData.readIndex &gt;= AUDIO_QUEUE_SIZE)
           {
               appData.readIndex = 0;
           }                                 
           appData.state = APP_STATE_BT_WAIT_FOR_BUFFER_COMPLETE;
       }
       <strong><span style="color: #000080">else</span></strong>
       {
           SYS_DEBUG(0, &quot;BT Buffer Read FAILED!!!&quot;);
       }
   }
   <strong><span style="color: #000080">else</span></strong>
   {
       <i><span style="color: #008000">//Overrun -- Wait for Read buffer to become available.</span></i>
       SYS_DEBUG(0, &quot;Buffer Overrunrn&quot;);
   }                             
}
<strong><span style="color: #000080">break</span></strong>;</pre></div></div>
</div>
</div>
<a name="43"></a><div class="Element99">
C</div>
<div class="Element101"><div class="Element100"><pre class="Element100"><strong><span style="color: #000080">void</span></strong> <strong><span style="color: #000000">DRV_BM64_BufferAddRead</span></strong>(
    <strong><span style="color: #000080">const</span></strong> DRV_HANDLE <strong><span style="color: #000000">handle</span></strong>, 
    <a href="00078.html" target="topic">DRV_BM64_BUFFER_HANDLE</a> * <strong><span style="color: #000000">bufferHandle</span></strong>, 
    <strong><span style="color: #000080">void</span></strong> * <strong><span style="color: #000000">buffer</span></strong>, 
    size_t <strong><span style="color: #000000">size</span></strong>
);</pre></div></div>
</div>
<!-- End Page Content -->

<!-- Begin Page Footer -->
<div class="Element95">
<a href="00023.html" target="topic">Drivers Libraries Help</a> &gt; <a href="00016.html" target="topic">BM64 Bluetooth Driver Library</a> &gt; <a href="00045.html" target="topic">Library Interface</a> &gt; c) Data Transfer Functions &gt; <a href="00080.html" target="topic">DRV_BM64_BufferAddRead Function</a></div>
<div class="Element93">
<table width="100%" cellspacing="0" cellpadding="0">
<tr><td width="25%">
<div class="Element3">
MPLAB Harmony Bluetooth Help</div>
</td><td width="25%">
<div class="Element4">
<a href="contents.html" target="tocidx">Contents</a> | <a href="00020.html" target="topic">Home</a></div>
</td><td width="25%">
<div class="Element91">
<a href="00151.html" target="topic">Previous</a> | <a href="00045.html" target="topic">Up</a> | <a href="00219.html" target="topic">Next</a></div>
</td><td width="25%">
<div class="Element97">
<a href="mailto:docerrors@microchip.com&subject=MPLAB Harmony Documentation Feedback (Topic ID: DRV_BM64_BufferAddRead@DRV_HANDLE@DRV_BM64_BUFFER_HANDLE *@void *@size_t Topic Title: DRV_BM64_BufferAddRead Function)&body=Thank you for your feedback! Please include a description of your feedback, and indicate whether you are reporting an an error in the documentation or an enhancement.">Documentation Feedback</a><br> <a href="http://support.microchip.com" target="_blank">Microchip Support</a></div>
</td></tr></table></div>

<!-- End Page Footer -->
</div>
</div>

<!-- End Client Area -->
</body></html>